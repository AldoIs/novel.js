function __range__(e,n,t){let a=[],r=e<n,o=t?r?n+1:n-1:n;for(let n=e;r?n<o:n>o;r?n++:n--)a.push(n);return a}function __range__(e,n,t){let a=[],r=e<n,o=t?r?n+1:n-1:n;for(let n=e;r?n<o:n>o;r?n++:n--)a.push(n);return a}function __range__(e,n,t){let a=[],r=e<n,o=t?r?n+1:n-1:n;for(let n=e;r?n<o:n>o;r?n++:n--)a.push(n);return a}function __in__(e,n){return n.indexOf(e)>=0}function __range__(e,n,t){let a=[],r=e<n,o=t?r?n+1:n-1:n;for(let n=e;r?n<o:n>o;r?n++:n--)a.push(n);return a}let novelData={novel:null,choices:null,debugMode:!1,status:"Loading",inventoryHidden:!1,choicesHidden:!1,printedText:"",parsedJavascriptCommands:[],parsedScrollsounds:[],music:[],csvEnabled:!1,input:{presses:0},printer:{fullText:"",currentText:"",currentOffset:0,defaultInterval:0,soundBuffer:[],musicBuffer:[],stopMusicBuffer:[],executeBuffer:[],buffersExecuted:!1,scrollSound:null,tickSoundFrequency:1,tickCounter:0,speedMod:!1,tickSpeedMultiplier:1,pause:0,interval:0,printCompleted:!1}},novelPath;"undefined"!=typeof Papa&&(novelData.csvEnabled=!0);class InputManager{static keyDown(e){if(!this.formsSelected())return 13===e||32===e?(novelData.novel.settings.scrollSettings.continueWithKeyboard&&SceneManager.tryContinue(),novelData.novel.settings.scrollSettings.skipWithKeyboard&&TextPrinter.trySkip(),TextPrinter.unpause()):void 0}static keyPressed(e){if(!this.formsSelected())return novelData.input.presses++,(13===e||32===e)&&novelData.input.presses>2&&novelData.novel.settings.scrollSettings.fastScrollWithKeyboard?TextPrinter.fastScroll():void 0}static keyUp(e){if(!this.formsSelected())return this.presses=0,13===e||32===e?TextPrinter.stopFastScroll():void 0}static formsSelected(){let e=document.getElementById("novel-area");if(e){let n=e.querySelectorAll("input");for(let e=0;e<n.length;e++){let t=n[e];if(t===document.activeElement)return!0}}return!1}}document.onkeydown=function(e){let n=(e=e||window.event).keyCode||e.which;return InputManager.keyDown(n)},document.onkeypress=function(e){let n=(e=e||window.event).keyCode||e.which;return InputManager.keyPressed(n)},document.onkeyup=function(e){let n=(e=e||window.event).keyCode||e.which;return InputManager.keyUp(n)};class InventoryManager{static checkRequirements(e){Util.checkFormat(e,"array");let n=0;for(let t=0;t<novelData.novel.inventories[novelData.novel.currentInventory].length;t++){let a=novelData.novel.inventories[novelData.novel.currentInventory][t];for(let t=0;t<e.length;t++){let r=e[t];r[0]===a.name&&r[1]<=a.value&&(n+=1)}}return n===e.length}static setValue(e,n){Util.checkFormat(e,"string");let t=this.getValueArrayLast(e);return Parser.findValue(e,!1)[t]=n}static increaseValue(e,n){Util.checkFormat(e,"string");let t=this.getValueArrayLast(e),a=Parser.findValue(e,!1);if(a[t]=a[t]+n,!isNaN(parseFloat(a[t])))return a[t]=parseFloat(a[t].toFixed(novelData.novel.settings.floatPrecision))}static decreaseValue(e,n){Util.checkFormat(e,"string");let t=this.getValueArrayLast(e),a=Parser.findValue(e,!1);if(a[t]=a[t]-n,!isNaN(parseFloat(a[t])))return a[t]=parseFloat(a[t].toFixed(novelData.novel.settings.floatPrecision))}static getValueArrayLast(e){let n=e.split(",");return n=n[n.length-1].split("."),n=n[n.length-1]}static addItems(e){return this.editItems(e,"add")}static setItems(e){return this.editItems(e,"set")}static removeItems(e){return this.editItems(e,"remove")}static editItems(e,n){Util.checkFormat(e,"array");for(let t=0;t<e.length;t++){let a=e[t],r=!1;"!"===a[0].substring(0,1)&&(r=!0,a[0]=a[0].substring(1,a[0].length));let o=this.tryEditInInventory(n,a,r);o||this.tryEditNotInInventory(n,a,r)}}static tryEditInInventory(e,n,t){for(let o=0;o<novelData.novel.inventories[novelData.novel.currentInventory].length;o++){let s=novelData.novel.inventories[novelData.novel.currentInventory][o];if(s.name===n[0]){let o=1;if(n.length>2){var a=n[2],r=parseInt(Parser.parseStatement(n[1]));isNaN(a)||(o=n[2],a=n.name),n.length>3&&(o=parseFloat(n[2]),a=n[3])}else var a=n[0],r=parseInt(Parser.parseStatement(n[1]));let i=Math.random();return i<o&&("set"===e?isNaN(parseInt(n[1]))?s.value=n[1]:s.value=parseInt(n[1]):"add"===e?(isNaN(parseInt(s.value))&&(s.value=0),s.value=parseInt(s.value)+r):"remove"===e&&(isNaN(parseInt(s.value))?s.value=0:(s.value=parseInt(s.value)-r,s.value<0&&(s.value=0))),s.hidden=t),!0}}return!1}static tryEditNotInInventory(e,n,t){if("remove"!==e){let e=1,r=parseInt(Parser.parseStatement(n[1]));if(isNaN(r)&&(r=Parser.parseStatement(n[1])),n.length>2){a=n[2];isNaN(a)||(e=n[2],a=n.name),n.length>3&&(e=parseFloat(n[2]),a=n[3])}else a=n[0];let o=Math.random();if(void 0===a)var a=n[0];if(o<e)return novelData.novel.inventories[novelData.novel.currentInventory].push({name:n[0],value:r,displayName:a,hidden:t})}}}class LanguageManager{static setLanguage(e){return novelData.novel.settings.language=e,UI.updateUILanguage()}static getUIString(e){Util.checkFormat(e,"string");for(let n=0;n<novelData.novel.uiText.length;n++){let t=novelData.novel.uiText[n];if(t.name===e&&t.language===novelData.novel.settings.language)return Parser.parseText(t.content)}return console.error(`Error! UI string ${e} not found!`),"[NOT FOUND]"}static getCorrectLanguageCsvString(e){if(Util.checkFormat(e,"string"),void 0===novelData.csvData||!1===novelData.csvEnabled)return console.error("Error! CSV data cannot be parsed, because Papa Parse can't be detected."),"[NOT FOUND]";for(let n=0;n<novelData.csvData.length;n++){let t=novelData.csvData[n];if(t.name===e)return void 0===t[novelData.novel.settings.language]?void 0===t.english?(console.error(`Error! No CSV value by name ${e} could be found.`),"[NOT FOUND]"):Parser.parseText(t.english):Parser.parseText(t[novelData.novel.settings.language])}}static getItemAttribute(e,n){switch(n){case"displayName":return"[csv]"===e.displayName?this.getCorrectLanguageCsvString(e.name+"|displayName"):this.getCorrectLanguageString(e.displayName);case"description":return"[csv]"===e.description?this.getCorrectLanguageCsvString(e.name+"|description"):this.getCorrectLanguageString(e.description);default:return console.error("Error! Trying to get an invalid item attribute in LanguageManager."),"[NOT FOUND]"}}static getCorrectLanguageString(e,n){if(Util.checkFormat(e,"arrayOrString"),"string"==typeof e)return e;if("[object Array]"===Object.prototype.toString.call(e))for(let n=0;n<e.length;n++){let t=e[n];if(t.language===novelData.novel.settings.language)return t.content}}}class NovelManager{static loadCookie(e){let n=e+"=",t=document.cookie.split(";"),a=0;for(;a<t.length;){let e=t[a];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(n))return e.substring(n.length,e.length);a++}}static saveCookie(e,n,t){let a=new Date;a.setTime(a.getTime()+24*t*60*60*1e3);let r=`expires=${a.toUTCString()}`;return document.cookie=e+"="+n+"; "+r+"; path=/"}static loadData(e,n){if(void 0===n&&(n=!0),void 0===e){if(""!==this.loadCookie("gameData")){console.log("Cookie found!");let e=this.loadCookie("gameData");console.log("Cookie loaded"),console.log(e);t=JSON.parse(atob(this.loadCookie("gameData")));return this.prepareLoadedData(t,n)}}else if(void 0!==e&&""!==e){var t=JSON.parse(atob(e));return this.prepareLoadedData(t,n)}}static prepareLoadedData(e,n){if(novelData.novel.name===e.name)return novelData.novel.version!==e.version&&console.warn("WARNING! novel version mismatch"),novelData.novel.inventories=e.inventories,novelData.debugMode=novelData.novel.debugMode,SoundManager.init(),n?SceneManager.updateScene(e.currentScene,!0):void 0;console.error("ERROR! novel name mismatch")}static saveDataAsJson(){let e=JSON.parse(JSON.stringify(novelData.novel));return delete e.scenes,delete e.tagPresets,delete e.sounds,delete e.externalText,delete e.externalJson,btoa(JSON.stringify(e))}static saveData(){let e=this.saveDataAsJson();return"cookie"===novelData.novel.settings.saveMode?this.saveCookie("novelData",e,365):"text"===novelData.novel.settings.saveMode?UI.showSaveNotification(e):void 0}static prepareData(e){e.currentScene="",e.parsedChoices="",void 0===e.currentInventory&&(e.currentInventory=0),void 0===e.inventories&&(e.inventories=[[]]),0===e.inventories.length&&(e.inventories[0]=[]),void 0===e.scenes&&(e.scenes=[{}]),void 0===e.tagPresets&&(e.tagPresets=[]),void 0===e.sounds&&(e.sounds=[]);for(let n=0;n<e.inventories.length;n++){let t=e.inventories[n];for(let e=0;e<t.length;e++){let n=t[e];void 0===n.displayName&&(n.displayName=n.name)}}for(let n=0;n<e.scenes.length;n++){let t=e.scenes[n];t.combinedText="",t.parsedText="",t.visited=!1,void 0===t.text&&(console.warn(`WARNING! scene ${t.name} has no text`),t.text=""),void 0===t.choices&&(console.warn(`WARNING! scene ${t.name} has no choices`),t.choices=[]);for(let e=0;e<t.choices.length;e++){let n=t.choices[e];n.parsedText="",void 0===n.alwaysShow&&(n.alwaysShow=!1)}}return void 0===e.settings&&(e.settings={}),void 0===e.settings.debugMode&&(e.settings.debugMode=!1),void 0===e.settings.saveMode&&(e.settings.saveMode="text"),void 0===e.settings.language&&(e.settings.language="english"),void 0===e.settings.showSaveButtons&&(e.settings.showSaveButtons=!0),void 0===e.settings.showSkipButton&&(e.settings.showSkipButton=!1),void 0===e.settings.inventoryHidden&&(e.settings.inventoryHidden=!1),void 0===e.settings.choicesHidden&&(e.settings.choicesHidden=!1),void 0===e.settings.alwaysShowDisabledChoices&&(e.settings.alwaysShowDisabledChoices=!1),void 0===e.settings.floatPrecision&&(e.settings.floatPrecision=5),void 0===e.settings.scrollSettings&&(e.settings.scrollSettings={}),void 0===e.settings.scrollSettings.defaultScrollSpeed&&(e.settings.scrollSettings.defaultScrollSpeed=60),void 0===e.settings.scrollSettings.revisitSkipEnabled&&(e.settings.scrollSettings.revisitSkipEnabled=!0),void 0===e.settings.scrollSettings.textSkipEnabled&&(e.settings.scrollSettings.textSkipEnabled=!0),void 0===e.settings.scrollSettings.skipWithKeyboard&&(e.settings.scrollSettings.skipWithKeyboard=!1),void 0===e.settings.scrollSettings.continueWithKeyboard&&(e.settings.scrollSettings.continueWithKeyboard=!0),void 0===e.settings.scrollSettings.fastScrollWithKeyboard&&(e.settings.scrollSettings.fastScrollWithKeyboard=!0),void 0===e.settings.scrollSettings.fastScrollSpeedMultiplier&&(e.settings.scrollSettings.fastScrollSpeedMultiplier=20),void 0===e.settings.scrollSettings.tickFreqThreshold&&(e.settings.scrollSettings.tickFreqThreshold=100),void 0===e.settings.soundSettings&&(e.settings.soundSettings={}),void 0===e.settings.soundSettings.soundVolume&&(e.settings.soundSettings.soundVolume=.5),void 0===e.settings.soundSettings.musicVolume&&(e.settings.soundSettings.musicVolume=.4),void 0===e.uiText?e.uiText=JSON.parse([{name:"saveText",language:"english",content:"Copy and save your save data:"},{name:"loadText",language:"english",content:"Paste your save data here:"},{name:"closeButton",language:"english",content:"Close"},{name:"copyButton",language:"english",content:"Copy"},{name:"saveButton",language:"english",content:"Save"},{name:"loadButton",language:"english",content:"Load"},{name:"loadDataButton",language:"english",content:"Load"},{name:"skipButton",language:"english",content:"Skip"},{name:"continueButton",language:"english",content:"Continue"},{name:"inventoryTitle",language:"english",content:"Inventory:"},{name:"hiddenInventoryTitle",language:"english",content:"Stats:"}]):e}static start(){console.log("-- Starting Novel.js... --"),this.getNovelName(),this.loadMainJson()}static getNovelName(){let e=document.getElementsByTagName("novel")[0];e||(e=document.getElementById("novel-area")),(novelPath=e.getAttribute("src"))||(novelPath="./novel")}static loadMainJson(){console.log("Loading main json...");let e=new XMLHttpRequest;return e.open("GET",novelPath+"/novel.json",!0),e.onload=function(){if(e.status>=200&&e.status<400){let n=JSON.parse(e.responseText);return NovelManager.loadExternalJson(n)}},e.onerror=function(){},e.send(),UI.showContinueButton(!1)}static loadExternalJson(e){if(console.log("Loading external json files..."),void 0===e.externalJson)return NovelManager.includeJsons(e,e),void NovelManager.loadExternalText(e);if(0===e.externalJson.length)return NovelManager.includeJsons(e,e),void NovelManager.loadExternalText(e);let n=0;return e.externalJson.map(t=>(function(t){let a=new XMLHttpRequest;return a.open("GET",novelPath+"/json/"+t.file,!0),a.onload=function(){if(a.status>=200&&a.status<400&&(t.content=JSON.parse(a.responseText),++n===e.externalJson.length))return NovelManager.includeJsons(e,e),NovelManager.loadExternalText(e)},a.onerror=function(){},a.send()})(t))}static includeJsons(e,n){if(void 0!==e.externalJson)for(let t in n)if("object"==typeof n[t]&&this.includeJsons(e,n[t]),void 0!==n[t].include)for(let a=0;a<e.externalJson.length;a++){let r=e.externalJson[a];if(r.name===n[t].include){n[t]=r.content,this.includeJsons(e,n[t]);break}}}static loadExternalText(e){if(console.log("Loading external text files..."),void 0===e.externalText)return void NovelManager.loadExternalCsv(e);if(0===e.externalText.length)return void NovelManager.loadExternalCsv(e);let n=0;return e.externalText.map(t=>(function(t){let a=new XMLHttpRequest;return a.open("GET",novelPath+"/texts/"+t.file,!0),a.onload=function(){if(a.status>=200&&a.status<400&&(t.content=a.responseText,++n===e.externalText.length))return NovelManager.loadExternalCsv(e)},a.onerror=function(){},a.send()})(t))}static loadExternalCsv(e){if(!novelData.csvEnabled)return NovelManager.prepareLoadedJson(e);{if(console.log("Loading external CSV files..."),void 0===e.externalText)return void NovelManager.prepareLoadedJson(e);if(0===e.externalText.length)return void NovelManager.prepareLoadedJson(e);let n=0;for(let t=0;t<e.externalCsv.length;t++){let a=e.externalCsv[t];Papa.parse(novelPath+"/csv/"+a.file,{download:!0,header:!0,comments:"#",complete(t){if(void 0===novelData.csvData?novelData.csvData=t.data:novelData.csvData=Util.mergeObjArrays(novelData.csvData,t.data),++n===e.externalCsv.length)return NovelManager.prepareLoadedJson(e)}})}}}static prepareLoadedJson(e){return e=this.prepareData(e),novelData.novel=e,novelData.debugMode=novelData.novel.settings.debugMode,SoundManager.init(),UI.init(),novelData.novel.currentScene=SceneManager.changeScene(novelData.novel.scenes[0].name),novelData.status="Ready",novelData.debugMode&&console.log(novelData),console.log("-- Loading Novel.js complete! --")}}class Parser{static selectRandomOption(e){Util.checkFormat(e,"string");let n=e.split("|");if(1===n.length)return n[0];let t=[];for(let e=0;e<n.length;e++){let a=n[e];a=a.split(","),t.push(a)}return t=this.chooseRandomly(t)}static chooseRandomly(e){let n=[],t=[],a=[],r=0;for(let o=0;o<e.length;o++){s=e[o];n.push(s[0]),r=parseFloat(s[1])+r,t.push(r),a.push(parseFloat(s[1]))}let o=0;for(let e=0;e<a.length;e++){var s=a[e];o+=parseFloat(s)}1!==o&&console.error("ERROR: Invalid scene or choice odds (should add up to exactly 1)!");let i=Math.random(),l=0;for(let e=0;e<t.length;e++){if(i<(s=t[e]))return n[l];l++}}static parseItems(e){if(Util.checkFormat(e,"string"),""===e)return;let n=e.split("|"),t=[];for(let e=0;e<n.length;e++){let a=n[e];a=a.split(","),t.push(a)}return t}static parseText(e){if(void 0!==e){Util.checkFormat(e,"string"),Util.validateTagParentheses(e)||console.error("ERROR: Invalid tags in text");let o=e.split("[file "),s=__range__(1,o.length,!0);for(let t=0;t<s.length;t++){let r="";if(o[n=s[t]]){let e=o[n].split("");for(let n=0;n<e.length&&"]"!==(a=e[n]);n++)r+=a}if(""!==(r=r.replace(/\s+/g,""))){let n=null;for(let e=0;e<novelData.novel.externalText.length;e++)if((a=novelData.novel.externalText[e]).name===r){n=a.content;break}null===n&&(n=LanguageManager.getCorrectLanguageCsvString(r)),null!==n&&(e=e.split(`[file ${r}]`).join(n))}}for(let n=0;n<novelData.novel.tagPresets.length;n++){let t=`[p ${(a=novelData.novel.tagPresets[n]).name}]`;e.indexOf(t)>-1&&(e=e.split(t).join(a.start)),t=`[/p ${a.name}]`,e.indexOf(t)>-1&&(e=e.split(t).join(a.end))}for(let n=0;n<100;n++)e=e.split(`[s${n}]`).join(`<span class="highlight-${n}">`);o=(e=(e=e.split("[/s]").join("</span>")).replace(/\/\[/g,"OPEN_BRACKET_REPLACEMENT").replace(/\/\]/g,"CLOSE_BRACKET_REPLACEMENT")).split(/\[|\]/);var n=0;for(let e=0;e<o.length;e++){var t=o[e];o[n]=t.replace(/OPEN_BRACKET_REPLACEMENT/g,"[").replace(/CLOSE_BRACKET_REPLACEMENT/g,"]"),n++}let i=0,l=0;n=0;let u=__range__(0,o.length-1,!0);for(let e=0;e<u.length;e++){if("if"===(t=o[n=u[e]]).substring(0,2)){r=t.split("if ");this.parseStatement(r[1])?o[n]="":(o[n]='<span style="display:none;">',i++)}else if("/if"===t.substring(0,3))i>0?(o[n]="</span>",i--):o[n]="";else if("inv."===t.substring(0,4)){let e=t.substring(4,t.length);o[n]=0;for(let t=0;t<novelData.novel.inventories[novelData.novel.currentInventory].length;t++)(a=novelData.novel.inventories[novelData.novel.currentInventory][t]).name===e&&(o[n]=a.value)}else if("print"===t.substring(0,5)){r=t.split("print ");r=this.parseStatement(r[1]),isNaN(parseFloat(r))||(r=parseFloat(r.toFixed(novelData.novel.settings.floatPrecision))),o[n]=r}else if("exec"===t.substring(0,4)){r=t.substring(5,t.length);let e=novelData.parsedJavascriptCommands.push(r);e--,o[n]=`<span class="execute-command com-${e}"></span>`}else if("pause"===t.substring(0,5)){r=t.substring(6,t.length);o[n]=`<span class="pause ${r}"></span>`}else if("sound"===t.substring(0,5)){r=t.split("sound ");o[n]=`<span class="play-sound ${r[1]}"></span>`}else if("/music"===t.substring(0,6)){r=t.split("/music ");o[n]=`<span class="stop-music ${r[1]}"></span>`}else if("music"===t.substring(0,5)){r=t.split("music ");o[n]=`<span class="play-music ${r[1]}"></span>`}else if("/speed"===t.substring(0,6))o[n]='<span class="default-speed"></span>';else if("speed"===t.substring(0,5)){r=t.split("speed ");o[n]=`<span class="set-speed ${r[1]}"></span>`}else if("/scrollSound"===t.substring(0,12))o[n]='<span class="default-scroll-sound"></span>';else if("scrollSound"===t.substring(0,11)){r=t.split("scrollSound ");let e=novelData.parsedScrollsounds.push(r);e--,o[n]=`<span class="set-scroll-sound s-${e}"></span>`}else if("input"===t.substring(0,5)){r=t.split("input ");let e="";for(let n=0;n<novelData.novel.inventories[novelData.novel.currentInventory].length;n++){var a=novelData.novel.inventories[novelData.novel.currentInventory][n];a.name===r[1]&&(e=a.value)}o[n]=`<input type="text" value="${e}" name="input" class="input-${r[1]}" onblur="UI.updateInputs(true)">`}else if("choice"===t.substring(0,6)){var r=t.split("choice ");o[n]=`<a href="#" onclick="SceneManager.selectChoiceByNameByClicking(event,'${r[1]}')">`,l++}else"/choice"===t.substring(0,7)&&(l>0?(o[n]="</a>",l--):o[n]="");n++}return e=o.join("")}}static parseStatement(s){if(void 0===s)return;s=s.toString(),Util.checkFormat(s,"string"),Util.validateParentheses(s)||console.error("ERROR: Invalid parentheses in statement"),s=s.replace(/\s+/g,"");let parsedString=s.split(/\(|\)|\+|\*|\-|\/|<=|>=|<|>|==|!=|\|\||&&/),parsedValues=[];for(let e=0;e<parsedString.length;e++){let n=parsedString[e],t=this.getStatementType(n);switch(t){case"item":let e=!1;for(let t=0;t<novelData.novel.inventories[novelData.novel.currentInventory].length;t++){var i=novelData.novel.inventories[novelData.novel.currentInventory][t];i.name===n.substring(4,n.length)&&(parsedValues.push(i.value),e=!0)}e||parsedValues.push(0);break;case"rand":n=n.split(".");let a=n[1].split(","),r=!0;if("minus"===a[0].substring(0,5)&&(a[0]=a[0].substring(5,a[0].length),r=!1),"minus"===a[1].substring(0,5)&&(a[1]=a[1].substring(5,a[1].length),r=!1),r)var result=Math.random()*a[1]+a[0];else var result=Math.random()*a[1]-a[0];if(void 0===a[2]&&(a[2]=0),0===a[2])var result=Math.round(result);else var result=parseFloat(result).toFixed(a[2]);parsedValues.push(result);break;case"var":n=this.findValue(n.substring(4,n.length),!0),n=isNaN(parseFloat(n))?`'${n}'`:parseFloat(n).toFixed(novelData.novel.settings.floatPrecision),parsedValues.push(n);break;case"float":parsedValues.push(parseFloat(n).toFixed(novelData.novel.settings.floatPrecision));break;case"int":parsedValues.push(parseInt(n));break;case"string":""!==n?parsedValues.push(`'${n}'`):parsedValues.push("")}}let iterable=__range__(0,parsedString.length-1,!0);for(let e=0;e<iterable.length;e++){var i=iterable[e];""!==parsedString[i]&&""!==parsedValues[i]&&(s=s.replace(new RegExp(parsedString[i],"g"),parsedValues[i]),s=s.replace(new RegExp("''","g"),"'"))}let returnVal=eval(s);return"true"===returnVal&&(returnVal=!0),"false"===returnVal&&(returnVal=!1),returnVal}static getStatementType(e){let n=null;return n="inv."===e.substring(0,4)?"item":"var."===e.substring(0,4)?"var":"rand."===e.substring(0,5)?"rand":isNaN(parseFloat(e))||-1!==e.toString().indexOf(".")?isNaN(parseFloat(e))||-1===e.toString().indexOf(".")?"string":"float":"int"}static findValue(e,n){let t=e.split(",");if(n)r=this.findValueByName(novelData.novel,t[0])[0];else if(t.length>1)r=this.findValueByName(novelData.novel,t[0])[0];else r=this.findValueByName(novelData.novel,t[0])[1];let a=__range__(0,t.length-1,!0);for(let e=0;e<a.length;e++){let o=a[e];if(Util.isOdd(o))r=r[parseInt(t[o])];else if(0!==o)if(n){"parsedText"!==t[o]&&"text"!==t[o]||(t[o]="parsedText",r.parsedText=this.parseText(r.text));r=this.findValueByName(r,t[o])[0]}else var r=this.findValueByName(r,t[o])[1]}return void 0===r&&console.warn("WARNING: Searched value not found."),r}static findValueByName(e,n){Util.checkFormat(n,"string");let t=n.split("."),a=e[t[0]];if(t[1]){t.splice(0,1);let e=t.join(".");return this.findValueByName(a,e)}let r=[];return r[0]=a,r[1]=e,r}}class SceneManager{static tryContinue(){if(TextPrinter.printCompleted&&1===TextPrinter.tickSpeedMultiplier)return this.selectChoiceByName("Continue")}static selectChoice(e){return this.exitScene(novelData.novel.currentScene),this.readItemEdits(e),this.readSounds(e,!0),this.readSaving(e),this.readExecutes(e),this.readCheckpoints(e),this.readLanguage(e),void 0!==e.nextScene?this.changeScene(e.nextScene):void 0!==e.nextChoice?this.selectChoiceByName(Parser.selectRandomOption(e.nextChoice)):this.updateScene(novelData.novel.currentScene,!0),UI.updateInventories()}static selectChoiceByNameByClicking(e,n){return e.stopPropagation(),e.preventDefault(),this.selectChoiceByName(n)}static selectChoiceByName(e){for(let n=0;n<novelData.novel.currentScene.choices.length;n++){let t=novelData.novel.currentScene.choices[n];if(t.name===e){this.selectChoice(t);break}}}static selectChoiceById(e){if(novelData.novel.currentScene.choices[e])return this.selectChoice(novelData.novel.currentScene.choices[e])}static exitScene(e){return e.visited=!0,UI.updateInputs(!1),UI.resetChoices()}static changeScene(e){Util.checkFormat(e,"string");let n=this.findSceneByName(Parser.selectRandomOption(e));return this.setupScene(n),n}static setupScene(e){return this.updateScene(e,!1),this.readItemEdits(novelData.novel.currentScene),this.readSounds(novelData.novel.currentScene,!1),this.readSaving(novelData.novel.currentScene),this.readExecutes(novelData.novel.currentScene),this.readCheckpoints(novelData.novel.currentScene),this.readLanguage(novelData.novel.currentScene),this.readMisc(novelData.novel.currentScene),UI.showHiddenInventoryArea(),TextPrinter.printText(e.parsedText,!1)}static updateScene(e,n){return e=this.combineSceneTexts(e),e.parsedText=Parser.parseText(e.combinedText),novelData.novel.currentScene=e,UI.updateStyle(e.style),n?(TextPrinter.printText(e.parsedText,!0),TextPrinter.complete()):novelData.novel.parsedChoices=null}static findSceneByName(e){Util.checkFormat(e,"string");for(let n=0;n<novelData.novel.scenes.length;n++){let t=novelData.novel.scenes[n];if(t.name===e)return t}return console.error(`ERROR: Scene by name '${e}' not found!`)}static combineSceneTexts(e){if(Util.checkFormat(e,"object"),Util.checkFormat(e.text,"arrayOrString"),e.combinedText="","[object Array]"===Object.prototype.toString.call(e.text))for(let n=0;n<e.text.length;n++){let t=e.text[n];e.combinedText=e.combinedText+"<p>"+LanguageManager.getCorrectLanguageString(t)+"</p>"}else e.combinedText=e.text;return e}static readItemEdits(e){if(void 0!==e.changeInventory&&(novelData.novel.currentInventory=Parser.parseStatement(e.changeInventory),novelData.novel.currentInventory>novelData.novel.inventories.length)){let e=__range__(0,novelData.novel.currentInventory,!0);for(let n=0;n<e.length;n++){let t=e[n];void 0===novelData.novel.inventories[t]&&(novelData.novel.inventories[t]=[])}}if(void 0!==e.removeItem&&InventoryManager.removeItems(Parser.parseItems(e.removeItem)),void 0!==e.addItem&&InventoryManager.addItems(Parser.parseItems(e.addItem)),void 0!==e.setItem&&InventoryManager.setItems(Parser.parseItems(e.setItem)),void 0!==e.setValue)for(let t=0;t<e.setValue.length;t++){n=e.setValue[t];InventoryManager.setValue(n.path,Parser.parseStatement(n.value.toString()))}if(void 0!==e.increaseValue)for(let t=0;t<e.increaseValue.length;t++){var n=e.increaseValue[t];InventoryManager.increaseValue(n.path,Parser.parseStatement(n.value.toString()))}if(void 0!==e.decreaseValue)return e.decreaseValue.map(e=>InventoryManager.decreaseValue(e.path,Parser.parseStatement(e.value.toString())))}static readSounds(e,n){let t=!1;return void 0!==e.playSound&&(SoundManager.playSound(Parser.parseStatement(e.playSound),!1),t=!0),n&&!t&&SoundManager.playDefaultClickSound(),void 0!==e.startMusic&&SoundManager.startMusic(Parser.parseStatement(e.startMusic)),void 0!==e.stopMusic&&SoundManager.stopMusic(Parser.parseStatement(e.stopMusic)),void 0!==e.scrollSound?novelData.novel.currentScene.scrollSound=Parser.parseStatement(e.scrollSound):novelData.novel.settings.soundSettings.defaultScrollSound?novelData.novel.currentScene.scrollSound=novelData.novel.settings.soundSettings.defaultScrollSound:novelData.novel.currentScene.scrollSound=void 0}static readExecutes(source){if(void 0!==source.executeJs)return eval(source.executeJs)}static readLanguage(e){if(void 0!==e.setLanguage)return LanguageManager.setLanguage(e.setLanguage)}static readMisc(e){if(void 0!==e.skipEnabled)n=Parser.parseStatement(e.skipEnabled);else n=novelData.novel.settings.scrollSettings.textSkipEnabled;if(novelData.novel.currentScene.skipEnabled=n,UI.showSkipButton(n),void 0!==e.revisitSkipEnabled?novelData.novel.currentScene.revisitSkipEnabled=Parser.parseStatement(e.revisitSkipEnabled):novelData.novel.currentScene.revisitSkipEnabled=novelData.novel.settings.scrollSettings.revisitSkipEnabled,void 0!==e.scrollSpeed?novelData.novel.currentScene.scrollSpeed=e.scrollSpeed:novelData.novel.currentScene.scrollSpeed=novelData.novel.settings.scrollSettings.defaultScrollSpeed,void 0!==e.inventoryHidden)n=Parser.parseStatement(e.inventoryHidden);else n=novelData.novel.settings.inventoryHidden;if(novelData.inventoryHidden=n,UI.showInventoryArea(!n),void 0!==e.choicesHidden)n=Parser.parseStatement(e.choicesHidden);else n=novelData.novel.settings.choicesHidden;if(novelData.choicesHidden=n,UI.showChoicesArea(!n),void 0!==e.saveButtonsHidden)n=Parser.parseStatement(e.saveButtonsHidden);else var n=!novelData.novel.settings.showSaveButtons;return novelData.saveButtonsHidden=n,UI.showSaveButtons(!n)}static readSaving(e){if(void 0!==e.save&&NovelManager.saveData(),void 0!==e.load)return UI.showLoadNotification()}static readCheckpoints(e){if(void 0!==e.saveCheckpoint){void 0===novelData.novel.checkpoints&&(novelData.novel.checkpoints=[]);let t=!1;for(let a=0;a<novelData.novel.checkpoints.length;a++)(n=novelData.novel.checkpoints[a]).name===Parser.parseStatement(e.saveCheckpoint)&&(n.scene=novelData.novel.currentScene.name,t=!0);if(!t){let n={name:Parser.parseStatement(e.saveCheckpoint),scene:novelData.novel.currentScene.name};novelData.novel.checkpoints.push(n)}}if(void 0!==e.loadCheckpoint){void 0===novelData.novel.checkpoints&&(novelData.novel.checkpoints=[]);for(let t=0;t<novelData.novel.checkpoints.length;t++){var n=novelData.novel.checkpoints[t];n.name===Parser.parseStatement(e.loadCheckpoint)&&this.changeScene(n.scene)}}}static requirementsFilled(e){let n=[];if(void 0!==e.itemRequirement){let t=Parser.parseItems(e.itemRequirement);n.push(InventoryManager.checkRequirements(t))}void 0!==e.requirement&&n.push(Parser.parseStatement(e.requirement));let t=!0;for(let e=0;e<n.length;e++){let a=n[e];!1===a&&(t=!1)}return t}}class SoundManager{static init(){let e=0;for(let n=0;n<novelData.novel.sounds.length;n++){let t=novelData.novel.sounds[n];t.sound=new Audio(novelPath+"/sounds/"+t.file),e++}}static playDefaultClickSound(e,n){return this.playSound(novelData.novel.settings.soundSettings.defaultClickSound,!1)}static playSound(e,n){if(void 0!==e){e=Parser.selectRandomOption(e);for(let t=0;t<novelData.novel.sounds.length;t++){let a=novelData.novel.sounds[t];if(a.name===e){let{sound:e}=a;return e.volume=n?novelData.novel.settings.soundSettings.musicVolume:novelData.novel.settings.soundSettings.soundVolume,e.play(),e}}}}static isPlaying(e){for(let e=0;e<novelData.music.length;e++){let n=novelData.music[e];return!n.paused}}static startMusic(e){for(let n=0;n<novelData.music.length;n++){let t=novelData.music[n];if(t.name===e)return}let n=this.playSound(e,!0);if(void 0!==n)return n.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),novelData.music.push({name:e,music:n})}static stopMusic(e){for(let n=0;n<novelData.music.length;n++){let t=novelData.music[n];if(e===t.name){t.music.pause();let e=novelData.music.indexOf(t);novelData.music.splice(e,1)}}}}class TextPrinter{static printText(e,n){if(novelData.printer.printCompleted=!1,novelData.printer.currentText="",UI.updateText(novelData.printer.currentText),UI.disableSkipButton(),UI.showContinueButton(!1),novelData.printer.fullText=e,novelData.printer.currentOffset=-1,novelData.printer.soundBuffer=[],novelData.printer.musicBuffer=[],novelData.printer.stopMusicBuffer=[],novelData.printer.executeBuffer=[],novelData.printer.buffersExecuted=!1,n&&(novelData.printer.buffersExecuted=!0),novelData.printer.defaultInterval=novelData.novel.currentScene.scrollSpeed,this.setTickSoundFrequency(novelData.printer.defaultInterval),!novelData.novel.currentScene.visited||!novelData.novel.currentScene.revisitSkipEnabled)return setTimeout(this.onTick(),novelData.printer.defaultInterval);this.complete()}static trySkip(){novelData.novel.currentScene.skipEnabled&&this.complete()}static complete(){novelData.printer.printCompleted=!0,novelData.printer.currentOffset=0,UI.enableSkipButton(),this.executeBuffers(),novelData.printer.currentText=novelData.printer.fullText,UI.updateText(novelData.printer.currentText),UI.updateChoices()}static executeBuffers(){if(!novelData.printer.buffersExecuted){let ss=[],first=!0;if(novelData.printer.fullText.indexOf("play-sound")>-1){var s=novelData.printer.fullText.split("play-sound ");for(let e=0;e<s.length;e++){var i=s[e];first||ss.push(i.split(/\s|\"/)[0]),first=!1}}if(ss.length>0){let e=__range__(0,ss.length,!0);for(let n=0;n<e.length;n++){var i=e[n];__in__(ss[i],novelData.printer.soundBuffer)||SoundManager.playSound(Parser.parseStatement(ss[i]))}}if(ss=[],first=!0,novelData.printer.fullText.indexOf("play-music")>-1){var s=novelData.printer.fullText.split("play-music ");for(let e=0;e<s.length;e++){var i=s[e];first||ss.push(i.split(/\s|\"/)[0]),first=!1}}if(ss.length>0){let e=__range__(0,ss.length,!0);for(let n=0;n<e.length;n++){var i=e[n];__in__(ss[i],novelData.printer.musicBuffer)||SoundManager.startMusic(Parser.parseStatement(ss[i]))}}if(ss=[],first=!0,novelData.printer.fullText.indexOf("stop-music")>-1){var s=novelData.printer.fullText.split("stop-music ");for(let e=0;e<s.length;e++){var i=s[e];first||ss.push(i.split(/\s|\"/)[0]),first=!1}}if(ss.length>0){let e=__range__(0,ss.length,!0);for(let n=0;n<e.length;n++){var i=e[n];__in__(ss[i],novelData.printer.stopMusicBuffer)||SoundManager.stopMusic(Parser.parseStatement(ss[i]))}}if(ss=[],first=!0,novelData.printer.fullText.indexOf("execute-command")>-1){var s=novelData.printer.fullText.split("execute-command ");for(let e=0;e<s.length;e++){var i=s[e];first||ss.push(i.split(/\s|\"/)[0]),first=!1}}if(ss.length>0){let iterable3=__range__(0,ss.length,!0);for(let k2=0;k2<iterable3.length;k2++){var i=iterable3[k2];__in__(ss[i],novelData.printer.executeBuffer)||void 0===ss[i]||eval(novelData.parsedJavascriptCommands[parseInt(ss[i].substring(4,ss[i].length))])}}novelData.printer.buffersExecuted=!0}}static unpause(){UI.showContinueButton(!1),"input"===novelData.printer.pause&&(novelData.printer.pause=0)}static fastScroll(){novelData.novel.currentScene.skipEnabled&&(novelData.printer.tickSpeedMultiplier=novelData.novel.settings.scrollSettings.fastScrollSpeedMultiplier)}static stopFastScroll(){novelData.printer.tickSpeedMultiplier=1}static setTickSoundFrequency(e){let n=novelData.novel.settings.scrollSettings.tickFreqThreshold;novelData.printer.tickSoundFrequency=1,e<=2*n&&(novelData.printer.tickSoundFrequency=2),e<=n&&(novelData.printer.tickSoundFrequency=3)}static onTick(){if("input"!==novelData.printer.pause&&novelData.printer.pause>0&&novelData.printer.pause--,0===novelData.printer.pause){if(novelData.printer.speedMod||(novelData.printer.interval=novelData.printer.defaultInterval),0===novelData.printer.defaultInterval)return void this.complete();if(novelData.printer.currentText===novelData.printer.fullText)return;for(;" "===novelData.printer.fullText[novelData.printer.currentOffset]||"<"===novelData.printer.fullText[novelData.printer.currentOffset]||">"===novelData.printer.fullText[novelData.printer.currentOffset];)this.readTags();if(novelData.printer.currentText=novelData.printer.fullText.substring(0,novelData.printer.currentOffset),UI.updateText(novelData.printer.currentText),++novelData.printer.currentOffset>=novelData.printer.fullText.length)return void this.complete();++novelData.printer.tickCounter>=novelData.printer.tickSoundFrequency&&"none"!==novelData.printer.scrollSound&&0!==novelData.printer.interval&&(null!==novelData.printer.scrollSound?SoundManager.playSound(novelData.printer.scrollSound):void 0!==novelData.novel.currentScene.scrollSound&&SoundManager.playSound(novelData.novel.currentScene.scrollSound),novelData.printer.tickCounter=0)}return this.setTickSoundFrequency(novelData.printer.interval/novelData.printer.tickSpeedMultiplier),setTimeout(function(){TextPrinter.onTick()},novelData.printer.interval/novelData.printer.tickSpeedMultiplier)}static readTags(){if(" "===novelData.printer.fullText[novelData.printer.currentOffset]&&novelData.printer.currentOffset++,">"===novelData.printer.fullText[novelData.printer.currentOffset]&&novelData.printer.currentOffset++,"<"===novelData.printer.fullText[novelData.printer.currentOffset]){let e=novelData.printer.currentOffset,n="";for(e++;">"!==novelData.printer.fullText[e-1]&&"<"!==novelData.printer.fullText[e];)n+=novelData.printer.fullText[e],e++;if((n=n.substring(1,n.length)).indexOf("display:none;")>-1){let n="",t=1;for(;;)if(e++,n+=novelData.printer.fullText[e],-1!==n.indexOf("/span")?(t--,n=""):-1!==n.indexOf("span")&&(t++,n=""),0===t)break;e++}this.bufferHidden(n),this.bufferNonHidden(n),novelData.printer.currentOffset=e,novelData.printer.offsetChanged=!0}}static bufferHidden(e){if(e.indexOf("play-sound")>-1&&e.indexOf("display:none;")>-1&&(n=(n=e.split("play-sound "))[1].split(/\s|\"/)[0],novelData.printer.soundBuffer.push(Parser.parseStatement(n))),e.indexOf("play-music")>-1&&e.indexOf("display:none;")>-1&&(n=(n=e.split("play-music "))[1].split(/\s|\"/)[0],novelData.printer.musicBuffer.push(Parser.parseStatement(n))),e.indexOf("stop-music")>-1&&e.indexOf("display:none;")>-1&&(n=(n=e.split("stop-music "))[1].split(/\s|\"/)[0],novelData.printer.stopMusicBuffer.push(Parser.parseStatement(n))),e.indexOf("execute-command")>-1&&e.indexOf("display:none;")>-1){var n=e.split("execute-command ");return n=n[1].split(/\s|\"/)[0],novelData.printer.executeBuffer.push(Parser.parseStatement(n))}}static bufferNonHidden(str){if(-1===str.indexOf("display:none;")){if(str.indexOf("play-sound")>-1){var s=str.split("play-sound ");s=s[1].split(/\s|\"/)[0],novelData.printer.soundBuffer.push(Parser.parseStatement(s)),SoundManager.playSound(Parser.parseStatement(s))}if(str.indexOf("play-music")>-1){var s=str.split("play-music ");s=s[1].split(/\s|\"/)[0],novelData.printer.musicBuffer.push(Parser.parseStatement(s)),SoundManager.startMusic(Parser.parseStatement(s))}if(str.indexOf("stop-music")>-1){var s=str.split("stop-music ");s=s[1].split(/\s|\"/)[0],novelData.printer.stopMusicBuffer.push(Parser.parseStatement(s)),SoundManager.stopMusic(Parser.parseStatement(s))}if(str.indexOf("pause")>-1){var s=str.split("pause ");s=s[1].split(/\s|\"/)[0],novelData.printer.pause=s,"input"===novelData.printer.pause&&UI.showContinueButton(!0)}if(str.indexOf("execute-command")>-1){var s=str.split("execute-command ");s=s[1].split(/\s|\"/)[0],novelData.printer.executeBuffer.push(s),void 0!==s&&eval(novelData.parsedJavascriptCommands[parseInt(s.substring(4,s.length))])}if(str.indexOf("set-speed")>-1){var s=str.split("set-speed ");s=s[1].split(/\s|\"/)[0],novelData.printer.interval=Parser.parseStatement(s),novelData.printer.speedMod=!0}if(str.indexOf("default-speed")>-1&&(novelData.printer.interval=novelData.printer.defaultInterval,novelData.printer.speedMod=!1),str.indexOf("set-scroll-sound")>-1){var s=str.split("set-scroll-sound ");s=s[1].split(/\s|\"/)[0],novelData.printer.scrollSound=Parser.selectRandomOption(novelData.parsedScrollsounds[parseInt(s.substring(2,s.length))][1]),console.log(novelData.printer.scrollSound+" ---")}if(str.indexOf("default-scroll-sound")>-1)return novelData.printer.scrollSound=void 0}}}class UI{static init(){let e=document.getElementsByTagName("novel")[0];if(e||(e=document.getElementById("novel-area")),e){let n=document.createElement("div");return n.id="novel-area",n.innerHTML=`<div id="novel-style-area">\r\n        <div id="novel-notification-wrapper">\r\n          <div id="novel-save-notification" class="novel-notification">\r\n            <p class="novel-save-text"></p>\r\n            <p><textarea name="save-text" readonly></textarea></p>\r\n            <p><button type="button" class="novel-close-button" onclick="UI.closeSaveNotification()"></button><button type="button" class="novel-copy-button" onclick="UI.copyText()"></button></p>\r\n          </div>\r\n          <div id="novel-load-notification" class="novel-notification">\r\n            <p class="novel-load-text"></p>\r\n            <p><textarea name="load-text"></textarea></p>\r\n            <p><button type="button" class="novel-close-button" onclick="UI.closeLoadNotification(false)"></button><button type="button" class="novel-load-data-button" onclick="UI.closeLoadNotification(true)"></button></p>\r\n          </div>\r\n        </div>\r\n        <div id="novel-text-area">\r\n          <div id="novel-text"></div>\r\n          <button type="button" class="novel-skip-button" onclick="TextPrinter.complete()"></button>\r\n          <button type="button" class="novel-continue-button" onclick="TextPrinter.unpause()"></button>\r\n        </div>\r\n        <div id="novel-choices-area">\r\n          <ul id="novel-choice-list"></ul>\r\n        </div>\r\n        <div id="novel-inventory-area">\r\n          <h5 class="novel-inventory-title"></h5>\r\n          <ul id="novel-inventory"></ul>\r\n        </div>\r\n        <div id="novel-hidden-inventory-area">\r\n          <h5 class="novel-hidden-inventory-title"></h5>\r\n          <ul id="novel-hidden-inventory"></ul>\r\n        </div>\r\n        <div id="novel-save-area">\r\n          <button type="button" class="novel-save-button" onclick="NovelManager.saveData()"></button>\r\n          <button type="button" class="novel-load-button" onclick="UI.showLoadNotification()"></button>\r\n        </div>\r\n      </div>`,e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e),void this.updateUILanguage()}}static updateUILanguage(){document.getElementsByClassName("novel-save-text")[0].innerHTML=LanguageManager.getUIString("saveText"),document.getElementsByClassName("novel-load-text")[0].innerHTML=LanguageManager.getUIString("loadText");let e=document.getElementsByClassName("novel-close-button");for(let n=0;n<e.length;n++){let t=e[n];t.innerHTML=LanguageManager.getUIString("closeButton")}document.getElementsByClassName("novel-copy-button")[0].innerHTML=LanguageManager.getUIString("copyButton"),document.getElementsByClassName("novel-skip-button")[0].innerHTML=LanguageManager.getUIString("skipButton"),document.getElementsByClassName("novel-continue-button")[0].innerHTML=LanguageManager.getUIString("continueButton"),document.getElementsByClassName("novel-inventory-title")[0].innerHTML=LanguageManager.getUIString("inventoryTitle"),document.getElementsByClassName("novel-hidden-inventory-title")[0].innerHTML=LanguageManager.getUIString("hiddenInventoryTitle"),document.getElementsByClassName("novel-load-button")[0].innerHTML=LanguageManager.getUIString("loadButton"),document.getElementsByClassName("novel-load-data-button")[0].innerHTML=LanguageManager.getUIString("loadDataButton"),document.getElementsByClassName("novel-save-button")[0].innerHTML=LanguageManager.getUIString("saveButton")}static updateStyle(e){let n=document.getElementById("novel-style-area");void 0===e&&(e=""),n.setAttribute("class",e)}static disableSkipButton(){null!==document.querySelector(".novel-skip-button")&&(document.querySelector(".novel-skip-button").disabled=!0)}static enableSkipButton(){null!==document.querySelector(".novel-skip-button")&&(document.querySelector(".novel-skip-button").disabled=!0)}static showSkipButton(e){let n=document.getElementsByClassName("novel-skip-button")[0];e&&novelData.novel.settings.showSkipButton?n.style.display="inline":n.style.display="none"}static showChoicesArea(e){let n=document.getElementById("novel-choices-area");n.style.display=e?"inline":"none"}static showInventoryArea(e){let n=document.getElementById("novel-inventory-area");n.style.display=e?"inline":"none"}static showHiddenInventoryArea(){let e=document.getElementById("novel-hidden-inventory-area");novelData.novel.settings.debugMode?e.style.display="inline":e.style.display="none"}static showSaveButtons(e){let n=document.getElementById("novel-save-area");n.style.display=e?"inline":"none"}static showContinueButton(e){null!==document.querySelector(".novel-continue-button")&&(document.querySelector(".novel-continue-button").style.display=e?"inline":"none")}static updateText(e){document.getElementById("novel-text").innerHTML=e}static showSaveNotification(e){let n=document.getElementById("novel-save-notification");n.querySelectorAll("textarea")[0].value=e,n.style.display="block"}static closeSaveNotification(){document.getElementById("novel-save-notification").style.display="none"}static showLoadNotification(){if("text"===novelData.novel.settings.saveMode){let e=document.getElementById("novel-load-notification");e.style.display="block"}else NovelManager.loadGame()}static closeLoadNotification(e,n){let t=document.getElementById("novel-load-notification");if(e){let e=t.querySelectorAll("textarea");NovelManager.loadData(e[0].value,n),e[0].value=""}t.style.display="none"}static copyText(){document.getElementById("novel-save-notification").querySelector("textarea").select();try{let e;return e=document.execCommand("copy")}catch(e){console.error(`Error! Copying to clipboard failed: ${e}`)}}static updateInputs(e){let n=document.getElementById("novel-area").querySelectorAll("input");for(let t=0;t<n.length;t++){let a=n[t];for(let n=0;n<novelData.novel.inventories[novelData.novel.currentInventory].length;n++){let t=novelData.novel.inventories[novelData.novel.currentInventory][n];t.name===a.className.substring(6,a.className.length)&&(t.value=Util.stripHTML(a.value),e&&SceneManager.updateScene(novelData.novel.currentScene,!0))}}}static resetChoices(){let e=document.getElementById("novel-choice-list");return(()=>{let n=[];for(;e.firstChild;)n.push(e.removeChild(e.firstChild));return n})()}static resetInventories(){let e=document.getElementById("novel-inventory");for(;e.firstChild;)e.removeChild(e.firstChild);return e=document.getElementById("novel-hidden-inventory"),(()=>{let n=[];for(;e.firstChild;)n.push(e.removeChild(e.firstChild));return n})()}static updateChoices(){this.resetChoices();let e=document.getElementById("novel-choice-list"),n=0,t=__range__(0,novelData.novel.currentScene.choices.length,!1);for(let r=0;r<novelData.novel.currentScene.choices.length;r++){n=t[r];let o=novelData.novel.currentScene.choices[n];if(o.text)if(o.parsedText=Parser.parseText(LanguageManager.getCorrectLanguageString(o.text)),SceneManager.requirementsFilled(o))(a=document.createElement("li")).innerHTML=`<a href="#"; onclick="SceneManager.selectChoiceById(${n})">${o.parsedText}</a>`,e.appendChild(a);else if(o.alwaysShow||novelData.novel.settings.alwaysShowDisabledChoices){var a=document.createElement("li");a.innerHTML=o.parsedText,e.appendChild(a)}}}static updateInventories(){this.resetInventories();let e=document.getElementById("novel-inventory"),n=document.getElementById("novel-hidden-inventory");for(let t=0;t<novelData.novel.inventories[novelData.novel.currentInventory].length;t++){let a=novelData.novel.inventories[novelData.novel.currentInventory][t],r=n;if(a.hidden&&void 0!==a.hidden||(r=e),a.value>0||isNaN(a.value)){let e=document.createElement("li");e.class="novel-inventory-item";let n=LanguageManager.getItemAttribute(a,"displayName")+" - "+a.value;n+='<ul class="novel-inventory-item-info">',a.description&&(n=n+'<li class="novel-inventory-item-description">'+LanguageManager.getItemAttribute(a,"description")+"</li>"),n+="</ul>",e.innerHTML=n,r.appendChild(e)}}}}class Util{static isEven(e){return e%2==0}static isOdd(e){return 1===Math.abs(e%2)}static stripHTML(e){let n=/(<([^>]+)>)/gi;return e.replace(n,"")}static checkFormat(e,n,t){return void 0===t&&(t=!1),"array"===n?"[object Array]"===Object.prototype.toString.call(e)||(t||console.error(`ERROR: Invalid input format (should be ${n})`),!1):"arrayOrString"===n?"[object Array]"===Object.prototype.toString.call(e)||"string"==typeof e||(t||console.error(`ERROR: Invalid input format (should be ${n})`),!1):typeof e===n||(t||console.error(`ERROR: Invalid input format (should be ${n})`),!1)}static validateParentheses(e){let n=0;for(let t=0;t<e.length;t++){let a=e[t];if("("===a&&n++,")"===a){if(!(n>0))return!1;n--}}return 0===n}static validateTagParentheses(e){let n=0,t=0;for(let a=0;a<e.length;a++){let r=e[a];if("["===r&&(e[t-1]?"/"!==e[t-1]&&n++:n++),"]"===r)if(e[t-1]){if("/"!==e[t-1]){if(!(n>0))return!1;n--}}else{if(!(n>0))return!1;n--}t++}return 0===n}static mergeObjArrays(e,n){let t={};return e.concat(n).forEach(function(e){let{name:n}=e,a=t[n];if(a)for(let n in e)a[n]=e[n];else t[n]=e}),Object.keys(t).map(e=>t[e])}}NovelManager.start();