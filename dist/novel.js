var GameManager,InputManager,InventoryManager,Parser,SceneManager,SoundManager,TextPrinter,UI,Util,copyButton,data,gameArea,gameManager,gamePath,inputManager,inventoryManager,parser,sceneManager,soundManager,textPrinter,ui,util,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};GameManager=function(){function e(){}return e.prototype.loadCookie=function(e){var t,n,s,a;for(a=e+"=",n=document.cookie.split(";"),s=0;s<n.length;){for(t=n[s];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(a))return t.substring(a.length,t.length);s++}return""},e.prototype.saveCookie=function(e,t,n){var s,a;return s=new Date,s.setTime(s.getTime()+24*n*60*60*1e3),a="expires="+s.toUTCString(),document.cookie=e+"="+t+"; "+a+"; path=/"},e.prototype.loadGame=function(e){var t,n;if(void 0===e){if(""!==this.loadCookie("gameData"))return console.log("Cookie found!"),t=this.loadCookie("gameData"),console.log("Cookie loaded"),console.log(t),n=JSON.parse(atob(this.loadCookie("gameData"))),this.prepareLoadedGame(n)}else if(void 0!==e)return n=JSON.parse(atob(e)),this.prepareLoadedGame(n)},e.prototype.prepareLoadedGame=function(e){return data.game.gameName!==e.gameName?void console.error("ERROR! Game name mismatch"):(data.game.version!==e.version&&console.warn("WARNING! Game version mismatch"),data.game=e,data.debugMode=data.game.debugMode,sceneManager.updateScene(data.game.currentScene,!0))},e.prototype.startGame=function(){var e;return e=new XMLHttpRequest,e.open("GET",gamePath+"/game.json",!0),e.onload=function(){var t;return e.status>=200&&e.status<400?(t=JSON.parse(e.responseText),t=gameManager.prepareData(t),data.game=t,data.game.currentScene=sceneManager.changeScene(data.game.scenes[0].name),data.debugMode=data.game.debugMode):void 0},e.onerror=function(){},e.send(),null!==document.querySelector("#continue-button")?document.querySelector("#continue-button").style.display="none":void 0},e.prototype.saveGameAsJson=function(){var e;return e=btoa(JSON.stringify(data.game))},e.prototype.saveGame=function(){var e;return e=this.saveGameAsJson(),"cookie"===data.game.settings.saveMode?this.saveCookie("gameData",e,365):"text"===data.game.settings.saveMode?ui.showSaveNotification(e):void 0},e.prototype.prepareData=function(e){var t,n,s,a,r,i,o,u,l,p,c,d;for(e.currentScene="",e.parsedChoices="",void 0===e.inventory&&(e.inventory=[]),void 0===e.stats&&(e.stats=[]),void 0===e.scenes&&(e.scenes=[]),l=e.inventory,s=0,r=l.length;r>s;s++)n=l[s],void 0===n.displayName&&(n.displayName=n.name);for(p=e.scenes,a=0,i=p.length;i>a;a++)for(d=p[a],d.combinedText="",d.parsedText="",c=d.choices,u=0,o=c.length;o>u;u++)t=c[u],t.parsedText="",void 0===t.nextScene&&(t.nextScene=""),void 0===t.alwaysShow&&(t.alwaysShow=!1);return e},e}(),InputManager=function(){function e(){}return e.prototype.presses=0,e.prototype.keyDown=function(e){return 13===e||32===e?(data.game.settings.scrollSettings.continueWithKeyboard&&sceneManager.tryContinue(),data.game.settings.scrollSettings.skipWithKeyboard&&textPrinter.trySkip(),textPrinter.unpause()):void 0},e.prototype.keyPressed=function(e){return this.presses++,(13===e||32===e)&&this.presses>2&&data.game.settings.scrollSettings.fastScrollWithKeyboard?textPrinter.fastScroll():void 0},e.prototype.keyUp=function(e){return this.presses=0,13===e||32===e?textPrinter.stopFastScroll():void 0},e}(),document.onkeydown=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,inputManager.keyDown(t)},document.onkeypress=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,inputManager.keyPressed(t)},document.onkeyup=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,inputManager.keyUp(t)},Parser=function(){function Parser(){}return Parser.prototype.parseItemsOrStats=function(e){var t,n,s,a,r;if(""!==e){for(r=e.split("|"),a=[],n=0,s=r.length;s>n;n++)t=r[n],t=t.split(","),a.push(t);return a}},Parser.prototype.parseText=function(e){var t,n,s,a,r,i,o,u,l,p,c,d,f,g,m,h,v,y,S,x,M,k,T,b,O,I;if(void 0!==e){for(h=data.game.tagPresets,a=0,i=h.length;i>a;a++)n=h[a],O="[p "+n.name+"]",e.indexOf(O)>-1&&(e=e.split(O).join(n.start)),O="[/p "+n.name+"]",e.indexOf(O)>-1&&(e=e.split(O).join(n.end));for(n=r=0;99>=r;n=++r)e=e.split("[s"+n+"]").join('<span class="highlight-'+n+'">');for(e=e.split("[/s]").join("</span>"),T=e.split(/\[|\]/),k=0,t=0,s=p=0,v=T.length-1;v>=0?v>=p:p>=v;s=v>=0?++p:--p){if(M=T[s],"if"===M.substring(0,2))g=M.split("if "),this.parseStatement(g[1])?T[s]="":(T[s]='<span style="display:none;">',k++);else if("/if"===M.substring(0,3))k>0?(T[s]="</span>",k--):T[s]="";else if("stat."===M.substring(0,5))for(I=M.substring(5,M.length),y=data.game.stats,d=0,o=y.length;o>d;d++)n=y[d],n.name===I&&(T[s]=n.value);else if("inv."===M.substring(0,4))for(I=M.substring(4,M.length),S=data.game.inventory,m=0,u=S.length;u>m;m++)n=S[m],n.name===I&&(T[s]=n.count);else if("print"===M.substring(0,5))g=M.split("print "),g=this.parseStatement(g[1]),isNaN(parseFloat(g))||(g=parseFloat(g.toFixed(data.game.settings.floatPrecision))),T[s]=g;else if("exec"===M.substring(0,4))g=M.substring(5,M.length),f=data.parsedJavascriptCommands.push(g),f--,T[s]='<span class="execute-command com-'+f+'"></span>';else if("pause"===M.substring(0,5))g=M.substring(6,M.length),T[s]='<span class="pause '+g+'"></span>';else if("sound"===M.substring(0,5))g=M.split("sound "),T[s]='<span class="play-sound '+g[1]+'"></span>';else if("stopMusic"===M.substring(0,9))g=M.split("stopMusic "),T[s]='<span class="stop-music '+g[1]+'"></span>';else if("music"===M.substring(0,5))g=M.split("music "),T[s]='<span class="play-music '+g[1]+'"></span>';else if("/speed"===M.substring(0,6))T[s]='<span class="default-speed"></span>';else if("speed"===M.substring(0,5))g=M.split("speed "),T[s]='<span class="set-speed '+g[1]+'"></span>';else if("/scrollSound"===M.substring(0,12))T[s]='<span class="default-scroll-sound"></span>';else if("scrollSound"===M.substring(0,11))g=M.split("scrollSound "),T[s]='<span class="set-scroll-sound '+g[1]+'"></span>';else if("input"===M.substring(0,5)){for(g=M.split("input "),c="",x=data.game.stats,b=0,l=x.length;l>b;b++)n=x[b],n.name===g[1]&&(c=n.value);T[s]='<input type="text" value="'+c+'" name="input" class="input-'+g[1]+'" onblur="ui.updateInputs(true)">'}else"choice"===M.substring(0,6)?(g=M.split("choice "),T[s]='<a href="#" onclick="sceneManager.selectChoiceByNameByClicking(event,\''+g[1]+"')\">",t++):"/choice"===M.substring(0,7)&&(t>0?(T[s]="</a>",t--):T[s]="");s++}return e=T.join("")}},Parser.prototype.parseStatement=function(s){var found,i,k,l,len,len1,len2,m,o,parsedString,parsedValues,ref,ref1,ref2,type,val;for(util.validateParentheses(s)||console.error("ERROR: Invalid parentheses in statement"),s=s.replace(/\s+/g,""),parsedString=s.split(/\(|\)|\+|\*|\-|\/|<=|>=|<|>|==|!=|\|\||&&/),parsedValues=[],k=0,len=parsedString.length;len>k;k++)switch(val=parsedString[k],type=this.getStatementType(val)){case"item":for(found=!1,ref=data.game.inventory,l=0,len1=ref.length;len1>l;l++)i=ref[l],i.name===val.substring(4,val.length)&&(parsedValues.push(i.count),found=!0);found||parsedValues.push(0);break;case"stats":for(found=!1,ref1=data.game.stats,m=0,len2=ref1.length;len2>m;m++)i=ref1[m],i.name===val.substring(5,val.length)&&(parsedValues.push(i.value),found=!0);found||parsedValues.push(0);break;case"var":val=this.findValue(val.substring(4,val.length),!0),isNaN(parseFloat(val))?parsedValues.push("'"+val+"'"):parsedValues.push(parseFloat(val).toFixed(data.game.settings.floatPrecision));break;case"float":parsedValues.push(parseFloat(val).toFixed(data.game.settings.floatPrecision));break;case"int":parsedValues.push(parseInt(val));break;case"string":""!==val?parsedValues.push("'"+val+"'"):parsedValues.push("")}for(i=o=0,ref2=parsedString.length-1;ref2>=0?ref2>=o:o>=ref2;i=ref2>=0?++o:--o)""!==parsedString[i]&&""!==parsedValues[i]&&(s=s.replace(new RegExp(parsedString[i],"g"),parsedValues[i]));return eval(s)},Parser.prototype.getStatementType=function(e){var t;return t=null,t="stat."===e.substring(0,5)?"stats":"inv."===e.substring(0,4)?"item":"var."===e.substring(0,4)?"var":isNaN(parseFloat(e))||-1!==e.toString().indexOf(".")?isNaN(parseFloat(e))||-1===e.toString().indexOf(".")?"string":"float":"int"},Parser.prototype.findValue=function(e,t){var n,s,a,r,i;for(r=e.split(","),i=t?this.findValueByName(data.game,r[0])[0]:r.length>1?this.findValueByName(data.game,r[0])[0]:this.findValueByName(data.game,r[0])[1],n=s=0,a=r.length-1;a>=0?a>=s:s>=a;n=a>=0?++s:--s)util.isOdd(n)?i=i[parseInt(r[n])]:0!==n&&(t?(("parsedText"===r[n]||"text"===r[n])&&(r[n]="parsedText",i.parsedText=this.parseText(i.text)),i=this.findValueByName(i,r[n])[0]):i=this.findValueByName(i,r[n])[1]);return i},Parser.prototype.findValueByName=function(e,t){var n,s,a,r;return a=t.split("."),n=e[a[0]],a[1]?(a.splice(0,1),s=a.join("."),this.findValueByName(n,s)):(r=[],r[0]=n,r[1]=e,r)},Parser}(),InventoryManager=function(){function e(){}return e.prototype.checkRequirements=function(e,t){var n,s,a,r,i,o,u,l,p,c,d,f,g;if(g=0,t)for(d=data.game.inventory,a=0,i=d.length;i>a;a++)for(n=d[a],r=0,o=e.length;o>r;r++)s=e[r],s[0]===n.name&&s[1]<=n.count&&(g+=1);else for(f=data.game.stats,p=0,u=f.length;u>p;p++)for(n=f[p],c=0,l=e.length;l>c;c++)s=e[c],s[0]===n.name&&s[1]<=n.value&&(g+=1);return g===e.length?!0:!1},e.prototype.setValue=function(e,t){var n,s;return n=this.getValueArrayLast(e),s=parser.findValue(e,!1),s[n]=t},e.prototype.increaseValue=function(e,t){var n,s;return n=this.getValueArrayLast(e),s=parser.findValue(e,!1),s[n]=s[n]+t,isNaN(parseFloat(s[n]))?void 0:s[n]=parseFloat(s[n].toFixed(data.game.settings.floatPrecision))},e.prototype.decreaseValue=function(e,t){var n,s;return n=this.getValueArrayLast(e),s=parser.findValue(e,!1),s[n]=s[n]-t,isNaN(parseFloat(s[n]))?void 0:s[n]=parseFloat(s[n].toFixed(data.game.settings.floatPrecision))},e.prototype.getValueArrayLast=function(e){var t;return t=e.split(","),t=t[t.length-1].split("."),t=t[t.length-1]},e.prototype.editItemsOrStats=function(e,t,n){var s,a,r,i,o,u,l,p,c,d,f,g;for(i=n?data.game.inventory:data.game.stats,l=0,c=e.length;c>l;l++){for(u=e[l],o=!1,p=0,d=i.length;d>p;p++)r=i[p],r.name===u[0]&&(f=1,u.length>2?(a=u[2],s=parseInt(parser.parseStatement(u[1])),isNaN(a)||(f=u[2],a=u.name),u.length>3&&(f=parseFloat(u[2]),a=u[3])):(a=u[0],s=parseInt(parser.parseStatement(u[1]))),g=Math.random(),f>g&&("set"===t?n?r.count=parseInt(u[1]):isNaN(parseInt(u[1]))?r.value=u[1]:r.value=parseInt(u[1]):"add"===t?n?r.count=parseInt(r.count)+s:(isNaN(parseInt(r.value))&&(r.value=0),r.value=parseInt(r.value)+s):"remove"===t&&(n?(r.count=parseInt(r.count)-s,r.count<0&&(r.count=0)):isNaN(parseInt(r.value))||(r.value=parseInt(r.value)-s,r.value<0&&(r.value=0)))),o=!0);o||"remove"===t||(f=1,s=parseInt(parser.parseStatement(u[1])),isNaN(s)&&(s=parser.parseStatement(u[1])),u.length>2?(a=u[2],isNaN(a)||(f=u[2],a=u.name),u.length>3&&(f=parseFloat(u[2]),a=u[3])):a=u[0],g=Math.random(),f>g&&(n?i.push({name:u[0],count:s,displayName:a}):i.push({name:u[0],value:s,displayName:a})))}return n?data.game.inventory=i:data.game.stats=i},e}(),SceneManager=function(){function SceneManager(){}return SceneManager.prototype.tryContinue=function(){return textPrinter.printCompleted&&1===textPrinter.tickSpeedMultiplier?this.selectChoiceByName("Continue"):void 0},SceneManager.prototype.selectChoice=function(e){return this.exitScene(data.game.currentScene),this.readItemAndStatsEdits(e),this.readSounds(e,!0),this.readSaving(e),this.readExecutes(e),this.readCheckpoints(e),""!==e.nextScene?this.changeScene(e.nextScene):""===e.nextScene?void 0!==e.nextChoice?this.selectChoiceByName(this.selectRandomOption(e.nextChoice)):this.updateScene(data.game.currentScene,!0):void 0},SceneManager.prototype.selectChoiceByNameByClicking=function(e,t){return e.stopPropagation(),e.preventDefault(),this.selectChoiceByName(t)},SceneManager.prototype.selectChoiceByName=function(e){var t,n,s,a,r;for(a=data.game.currentScene.choices,r=[],n=0,s=a.length;s>n;n++){if(t=a[n],t.name===e){gameArea.selectChoice(t);break}r.push(void 0)}return r},SceneManager.prototype.exitScene=function(e){return ui.updateInputs(!1)},SceneManager.prototype.changeScene=function(e){var t;return t=this.findSceneByName(this.selectRandomOption(e)),this.setupScene(t),t},SceneManager.prototype.setupScene=function(e){return this.updateScene(e,!1),this.readItemAndStatsEdits(data.game.currentScene),this.readSounds(data.game.currentScene,!1),this.readSaving(data.game.currentScene),this.readExecutes(data.game.currentScene),this.readCheckpoints(data.game.currentScene),this.readMisc(data.game.currentScene),textPrinter.printText(e.parsedText,!1)},SceneManager.prototype.updateScene=function(e,t){return this.combineSceneTexts(e),e.parsedText=parser.parseText(e.combinedText),data.game.currentScene=e,t?(textPrinter.printText(e.parsedText,!0),textPrinter.complete()):data.game.parsedChoices=null},SceneManager.prototype.updateChoices=function(){return gameArea.$set("game.parsedChoices",data.game.currentScene.choices.map(function(e){return e.parsedText=parser.parseText(e.text),gameArea.game.settings.alwaysShowDisabledChoices&&(e.alwaysShow=!0),e}))},SceneManager.prototype.selectRandomOption=function(e){var t,n,s,a,r;if(r=e.split("|"),1===r.length)return r[0];for(a=[],n=0,s=r.length;s>n;n++)t=r[n],t=t.split(","),a.push(t);return console.log(a),a=this.chooseRandomly(a)},SceneManager.prototype.chooseRandomly=function(e){var t,n,s,a,r,i,o,u,l,p,c,d,f,g;for(p=[],t=[],d=[],c=0,s=0,r=e.length;r>s;s++)n=e[s],p.push(n[0]),c=parseFloat(n[1])+c,t.push(c),d.push(parseFloat(n[1]));for(f=0,a=0,i=d.length;i>a;a++)n=d[a],f+=parseFloat(n);for(1!==f&&console.error("ERROR: Invalid scene or choice odds (should add up to exactly 1)!"),g=Math.random(),l=0,u=0,o=t.length;o>u;u++){if(n=t[u],n>g)return p[l];l++}},SceneManager.prototype.findSceneByName=function(e){var t,n,s,a;for(a=data.game.scenes,n=0,s=a.length;s>n;n++)if(t=a[n],t.name===e)return t;return console.error("ERROR: Scene by name '"+e+"' not found!")},SceneManager.prototype.combineSceneTexts=function(e){var t,n,s,a,r;if(e.combinedText="","[object Array]"===Object.prototype.toString.call(e.text)){for(a=e.text,r=[],n=0,s=a.length;s>n;n++)t=a[n],r.push(e.combinedText=e.combinedText+"<p>"+t+"</p>");return r}return e.combinedText=e.text},SceneManager.prototype.readItemAndStatsEdits=function(e){var t,n,s,a,r,i,o,u,l,p,c;if(void 0!==e.removeItem&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.removeItem),"remove",!0),void 0!==e.addItem&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.addItem),"add",!0),void 0!==e.setItem&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.setItem),"set",!0),void 0!==e.removeStats&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.removeStats),"remove",!1),void 0!==e.addStats&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.addStats),"add",!1),void 0!==e.setStats&&inventoryManager.editItemsOrStats(parser.parseItemsOrStats(e.setStats),"set",!1),void 0!==e.setValue)for(o=e.setValue,t=0,s=o.length;s>t;t++)c=o[t],inventoryManager.setValue(c.path,parser.parseStatement(c.value.toString()));if(void 0!==e.increaseValue)for(u=e.increaseValue,n=0,a=u.length;a>n;n++)c=u[n],inventoryManager.increaseValue(c.path,parser.parseStatement(c.value.toString()));if(void 0!==e.decreaseValue){for(l=e.decreaseValue,p=[],i=0,r=l.length;r>i;i++)c=l[i],p.push(inventoryManager.decreaseValue(c.path,parser.parseStatement(c.value.toString())));return p}},SceneManager.prototype.readSounds=function(e,t){var n;return n=!1,void 0!==e.playSound&&(soundManager.playSound(e.playSound,!1),n=!0),t&&!n&&soundManager.playDefaultClickSound(),void 0!==e.startMusic&&soundManager.startMusic(e.startMusic),void 0!==e.stopMusic&&soundManager.stopMusic(e.stopMusic),void 0!==e.scrollSound?data.game.currentScene.scrollSound=e.scrollSound:data.game.settings.soundSettings.defaultScrollSound?data.game.currentScene.scrollSound=data.game.settings.soundSettings.defaultScrollSound:data.game.currentScene.scrollSound=void 0},SceneManager.prototype.readExecutes=function(source){return void 0!==source.executeJs?eval(source.executeJs):void 0},SceneManager.prototype.readMisc=function(e){return void 0!==e.skipEnabled?data.game.currentScene.skipEnabled=e.skipEnabled:data.game.currentScene.skipEnabled=data.game.settings.scrollSettings.textSkipEnabled,void 0!==e.scrollSpeed?data.game.currentScene.scrollSpeed=e.scrollSpeed:data.game.currentScene.scrollSpeed=data.game.settings.scrollSettings.defaultScrollSpeed},SceneManager.prototype.readSaving=function(e){return void 0!==e.saveGame&&gameManager.saveGame(),void 0!==e.loadGame?ui.showLoadNotification():void 0},SceneManager.prototype.readCheckpoints=function(e){var t,n,s,a,r,i,o,u,l,p;if(void 0!==e.saveCheckpoint){for(void 0===data.game.checkpoints&&(data.game.checkpoints=[]),n=!1,u=data.game.checkpoints,a=0,i=u.length;i>a;a++)s=u[a],s.name===e.saveCheckpoint&&(s.scene=data.game.currentScene.name,n=!0);n||(t={name:e.saveCheckpoint,scene:data.game.currentScene.name},data.game.checkpoints.push(t))}if(void 0!==e.loadCheckpoint){for(void 0===data.game.checkpoints&&(data.game.checkpoints=[]),l=data.game.checkpoints,p=[],r=0,o=l.length;o>r;r++)s=l[r],s.name===e.loadCheckpoint?p.push(this.changeScene(s.scene)):p.push(void 0);return p}},SceneManager.prototype.requirementsFilled=function(e){var t,n,s,a,r,i;for(a=[],void 0!==e.itemRequirement&&(r=parser.parseItemsOrStats(e.itemRequirement),a.push(inventoryManager.checkRequirements(r,!0))),void 0!==e.statsRequirement&&(r=parser.parseItemsOrStats(e.statsRequirement),a.push(inventoryManager.checkRequirements(r,!1))),void 0!==e.requirement&&a.push(inventoryManager.parseIfStatement(e.requirement)),i=!0,t=0,n=a.length;n>t;t++)s=a[t],s===!1&&(i=!1);return i},SceneManager}(),SoundManager=function(){function e(){}return e.prototype.playDefaultClickSound=function(e,t){return this.playSound(data.game.settings.soundSettings.defaultClickSound,!1)},e.prototype.playSound=function(e,t){var n,s,a,r,i;for(a=data.game.sounds,n=0,s=a.length;s>n;n++)if(r=a[n],r.name===e)return i=new Audio(gamePath+"/sounds/"+r.file),t?i.volume=data.game.settings.soundSettings.musicVolume:i.volume=data.game.settings.soundSettings.soundVolume,i.play(),i},e.prototype.isPlaying=function(e){var t,n,s,a;for(a=data.music,n=0,s=a.length;s>n;n++)return t=a[n],t.paused?!1:!0},e.prototype.startMusic=function(e){var t;return t=this.playSound(e,!0),t.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),data.music.push({name:e,music:t})},e.prototype.stopMusic=function(e){var t,n,s,a,r,i;for(r=data.music,i=[],s=0,a=r.length;a>s;s++)t=r[s],e===t.name?(t.music.pause(),n=data.music.indexOf(t),i.push(data.music.splice(n,1))):i.push(void 0);return i},e}(),TextPrinter=function(){function TextPrinter(){}return TextPrinter.prototype.fullText="",TextPrinter.prototype.currentOffset=0,TextPrinter.prototype.defaultInterval=0,TextPrinter.prototype.soundBuffer=[],TextPrinter.prototype.musicBuffer=[],TextPrinter.prototype.stopMusicBuffer=[],TextPrinter.prototype.executeBuffer=[],TextPrinter.prototype.buffersExecuted=!1,TextPrinter.prototype.scrollSound=null,TextPrinter.prototype.tickSoundFrequency=1,TextPrinter.prototype.tickCounter=0,TextPrinter.prototype.tickSpeedMultiplier=1,TextPrinter.prototype.speedMod=!1,TextPrinter.prototype.pause=0,TextPrinter.prototype.interval=0,TextPrinter.prototype.printCompleted=!1,TextPrinter.prototype.printText=function(e,t){return this.printCompleted=!1,data.printedText="",null!==document.querySelector("#skip-button")&&(document.querySelector("#skip-button").disabled=!1),this.fullText=e,this.currentOffset=-1,this.soundBuffer=[],this.musicBuffer=[],this.stopMusicBuffer=[],this.executeBuffer=[],this.buffersExecuted=!1,t&&(this.buffersExecuted=!0),this.defaultInterval=data.game.currentScene.scrollSpeed,this.setTickSoundFrequency(this.defaultInterval),setTimeout(this.onTick(),this.defaultInterval)},TextPrinter.prototype.trySkip=function(){return data.game.currentScene.skipEnabled?this.complete():void 0},TextPrinter.prototype.complete=function(){var first,i,k,l,len,len1,len2,len3,m,o,q,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,s,ss,t,u,v;if(this.printCompleted=!0,this.currentOffset=0,null!==document.querySelector("#skip-button")&&(document.querySelector("#skip-button").disabled=!0),!this.buffersExecuted){if(ss=[],first=!0,this.fullText.indexOf("play-sound")>-1)for(s=this.fullText.split("play-sound "),k=0,len=s.length;len>k;k++)i=s[k],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=l=0,ref=ss.length;ref>=0?ref>=l:l>=ref;i=ref>=0?++l:--l)ref1=ss[i],indexOf.call(this.soundBuffer,ref1)>=0||soundManager.playSound(ss[i]);if(ss=[],first=!0,this.fullText.indexOf("play-music")>-1)for(s=this.fullText.split("play-music "),m=0,len1=s.length;len1>m;m++)i=s[m],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=o=0,ref2=ss.length;ref2>=0?ref2>=o:o>=ref2;i=ref2>=0?++o:--o)ref3=ss[i],indexOf.call(this.musicBuffer,ref3)>=0||soundManager.startMusic(ss[i]);if(ss=[],first=!0,this.fullText.indexOf("stop-music")>-1)for(s=this.fullText.split("stop-music "),q=0,len2=s.length;len2>q;q++)i=s[q],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=t=0,ref4=ss.length;ref4>=0?ref4>=t:t>=ref4;i=ref4>=0?++t:--t)ref5=ss[i],indexOf.call(this.stopMusicBuffer,ref5)>=0||soundManager.stopMusic(ss[i]);if(ss=[],first=!0,this.fullText.indexOf("execute-command")>-1)for(s=this.fullText.split("execute-command "),u=0,len3=s.length;len3>u;u++)i=s[u],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=v=0,ref6=ss.length;ref6>=0?ref6>=v:v>=ref6;i=ref6>=0?++v:--v)ref7=ss[i],indexOf.call(this.executeBuffer,ref7)>=0||void 0===ss[i]||eval(data.parsedJavascriptCommands[parseInt(s.substring(4,s.length))]);this.buffersExecuted=!0}return data.printedText=this.fullText,sceneManager.updateChoices()},TextPrinter.prototype.unpause=function(){return null!==document.querySelector("#continue-button")&&(document.querySelector("#continue-button").style.display="none"),"input"===this.pause?this.pause=0:void 0},TextPrinter.prototype.fastScroll=function(){return data.game.currentScene.skipEnabled?this.tickSpeedMultiplier=data.game.settings.scrollSettings.fastScrollSpeedMultiplier:void 0},TextPrinter.prototype.stopFastScroll=function(){return this.tickSpeedMultiplier=1},TextPrinter.prototype.setTickSoundFrequency=function(e){var t;return t=data.game.settings.scrollSettings.tickFreqThreshold,this.tickSoundFrequency=1,2*t>=e&&(this.tickSoundFrequency=2),t>=e?this.tickSoundFrequency=3:void 0},TextPrinter.prototype.onTick=function(){var e;if("input"!==this.pause&&this.pause>0&&this.pause--,0===this.pause){if(this.speedMod||(this.interval=this.defaultInterval),0===this.defaultInterval)return void this.complete();if(data.printedText===this.fullText)return;for(e=!1;" "===this.fullText[this.currentOffset]||"<"===this.fullText[this.currentOffset]||">"===this.fullText[this.currentOffset];)this.readTags();if(data.printedText=this.fullText.substring(0,this.currentOffset),e||this.currentOffset++,this.currentOffset>=this.fullText.length)return void this.complete();this.tickCounter++,this.tickCounter>=this.tickSoundFrequency&&"none"!==this.scrollSound&&0!==this.interval&&(null!==this.scrollSound?soundManager.playSound(this.scrollSound):void 0!==data.game.currentScene.scrollSound&&soundManager.playSound(data.game.currentScene.scrollSound),this.tickCounter=0)}return this.setTickSoundFrequency(this.interval/this.tickSpeedMultiplier),setTimeout(function(){textPrinter.onTick()},this.interval/this.tickSpeedMultiplier)},TextPrinter.prototype.readTags=function(){var disp,i,s,spans,str;if(" "===this.fullText[this.currentOffset]&&this.currentOffset++,">"===this.fullText[this.currentOffset]&&this.currentOffset++,"<"===this.fullText[this.currentOffset]){for(i=this.currentOffset,str="",i++;">"!==this.fullText[i-1]&&"<"!==this.fullText[i];)str+=this.fullText[i],i++;if(str=str.substring(1,str.length),str.indexOf("display:none;")>-1){for(disp="",spans=1;;)if(i++,disp+=this.fullText[i],-1!==disp.indexOf("/span")?(spans--,disp=""):-1!==disp.indexOf("span")&&(spans++,disp=""),0===spans)break;i++}return str.indexOf("play-sound")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("play-sound "),s=s[1].split(/\s|\"/)[0],this.soundBuffer.push(s)),str.indexOf("play-music")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("play-music "),s=s[1].split(/\s|\"/)[0],this.musicBuffer.push(s)),str.indexOf("stop-music")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("stop-music "),s=s[1].split(/\s|\"/)[0],this.stopMusicBuffer.push(s)),str.indexOf("execute-command")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("execute-command "),s=s[1].split(/\s|\"/)[0],this.executeBuffer.push(s)),-1===str.indexOf("display:none;")&&(str.indexOf("play-sound")>-1&&(s=str.split("play-sound "),s=s[1].split(/\s|\"/)[0],this.soundBuffer.push(s),soundManager.playSound(s)),str.indexOf("play-music")>-1&&(s=str.split("play-music "),s=s[1].split(/\s|\"/)[0],this.musicBuffer.push(s),soundManager.startMusic(s)),str.indexOf("stop-music")>-1&&(s=str.split("stop-music "),s=s[1].split(/\s|\"/)[0],this.stopMusicBuffer.push(s),soundManager.stopMusic(s)),str.indexOf("pause")>-1&&(s=str.split("pause "),s=s[1].split(/\s|\"/)[0],this.pause=s,null!==document.querySelector("#continue-button")&&(document.querySelector("#continue-button").style.display="inline")),str.indexOf("execute-command")>-1&&(s=str.split("execute-command "),s=s[1].split(/\s|\"/)[0],this.executeBuffer.push(s),void 0!==s&&eval(data.parsedJavascriptCommands[parseInt(s.substring(4,s.length))])),str.indexOf("set-speed")>-1&&(s=str.split("set-speed "),s=s[1].split(/\s|\"/)[0],this.interval=parser.parseStatement(s),this.speedMod=!0),str.indexOf("default-speed")>-1&&(this.interval=this.defaultInterval,this.speedMod=!1),str.indexOf("set-scroll-sound")>-1&&(s=str.split("set-scroll-sound "),s=s[1].split(/\s|\"/)[0],this.scrollSound=s),str.indexOf("default-scroll-sound")>-1&&(this.scrollSound=null)),this.currentOffset=i,this.offsetChanged=!0}},TextPrinter}(),UI=function(){function e(){}return e.prototype.showSaveNotification=function(e){var t,n;return t=document.getElementById("save-notification"),n=t.querySelectorAll("textarea"),n[0].value=e,t.style.display="block"},e.prototype.closeSaveNotification=function(){var e;return e=document.getElementById("save-notification"),e.style.display="none"},e.prototype.showLoadNotification=function(){var e;return"text"===gameArea.game.settings.saveMode?(e=document.getElementById("load-notification"),e.style.display="block"):gameManager.loadGame()},e.prototype.closeLoadNotification=function(e){var t,n;return t=document.getElementById("load-notification"),e&&(n=t.querySelectorAll("textarea"),gameManager.loadGame(n[0].value),n[0].value=""),t.style.display="none"},e.prototype.updateInputs=function(e){var t,n,s,a,r,i;for(s=document.getElementById("game-area").querySelectorAll("input"),i=[],a=0,r=s.length;r>a;a++)n=s[a],i.push(function(){var s,a,r,i;for(r=data.game.stats,i=[],s=0,a=r.length;a>s;s++)t=r[s],t.name===n.className.substring(6,n.className.length)?(t.value=util.stripHTML(n.value),e?i.push(sceneManager.updateScene(data.game.currentScene,!0)):i.push(void 0)):i.push(void 0);return i}());return i},e}(),copyButton=document.querySelector("#copy-button"),null!==copyButton&&copyButton.addEventListener("click",function(e){var t,n,s,a;t=document.getElementById("save-notification").querySelector("textarea"),t.select();try{a=document.execCommand("copy")}catch(s){n=s,console.error("Copying to clipboard failed: "+n)}}),Util=function(){function e(){}return e.prototype.isEven=function(e){return e%2===0},e.prototype.isOdd=function(e){return 1===Math.abs(e%2)},e.prototype.stripHTML=function(e){var t;return t=/(<([^>]+)>)/gi,e.replace(t,"")},e.prototype.validateParentheses=function(e){var t,n,s,a;for(a=0,n=0,s=e.length;s>n;n++)if(t=e[n],"("===t&&a++,")"===t){if(!(a>0))return!1;a--}return 0===a?!0:!1},e}(),data={game:null,choices:null,debugMode:!1,printedText:"",parsedJavascriptCommands:[],music:[]},gamePath="./game",gameManager=new GameManager,inputManager=new InputManager,inventoryManager=new InventoryManager,parser=new Parser,sceneManager=new SceneManager,soundManager=new SoundManager,textPrinter=new TextPrinter,ui=new UI,util=new Util,gameArea=new Vue({el:"#game-area",data:data,methods:{requirementsFilled:function(e){return sceneManager.requirementsFilled(e)},textSkipEnabled:function(e){return data.game.currentScene.skipEnabled&&data.game.settings.skipButtonShown},itemsOverZero:function(e){var t,n,s,a;for(a=this.game.inventory,n=0,s=a.length;s>n;n++)if(t=a[n],t.name===e.name&&t.count>0)return!0;return!1},selectChoice:function(e){return sceneManager.selectChoice(e)}}}),gameManager.startGame();